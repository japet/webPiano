{"version":3,"file":"type.cjs","names":["Object","defineProperty","exports","value","default","typeTokenizer","util_js_1","require","spacing","join","getJoiner","spec","curlies","lines","descriptionBegun","firstTypeIteration","tokens","source","values","type","description","trim","ch","push","problems","code","message","line","number","critical","parts","offset","postDelimiter","length","i","entries","slice","postType","splitSpace","x","t","map"],"sources":["type.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = typeTokenizer;\nconst util_js_1 = require(\"../../util.js\");\n/**\n * Sets splits remaining `Spec.lines[].tokens.description` into `type` and `description`\n * tokens and populates Spec.type`\n *\n * @param {Spacing} spacing tells how to deal with a whitespace\n * for type values going over multiple lines\n */\nfunction typeTokenizer(spacing = 'compact') {\n    const join = getJoiner(spacing);\n    return (spec) => {\n        let curlies = 0;\n        let lines = [];\n        let descriptionBegun = false;\n        let firstTypeIteration = true;\n        for (const { tokens } of spec.source.values()) {\n            let type = '';\n            if (!descriptionBegun && tokens.description.trim()) {\n                descriptionBegun = true;\n            }\n            else if (!descriptionBegun) {\n                continue;\n            }\n            if (firstTypeIteration && tokens.description[0] !== '{')\n                return spec;\n            firstTypeIteration = false;\n            for (const ch of tokens.description) {\n                if (ch === '{')\n                    curlies++;\n                if (ch === '}')\n                    curlies--;\n                type += ch;\n                if (curlies === 0)\n                    break;\n            }\n            lines.push([tokens, type]);\n            if (curlies === 0)\n                break;\n        }\n        if (!descriptionBegun) {\n            return spec;\n        }\n        if (curlies !== 0) {\n            spec.problems.push({\n                code: 'spec:type:unpaired-curlies',\n                message: 'unpaired curlies',\n                line: spec.source[0].number,\n                critical: true,\n            });\n            return spec;\n        }\n        const parts = [];\n        const offset = lines[0][0].postDelimiter.length;\n        for (const [i, [tokens, type]] of lines.entries()) {\n            tokens.type = type;\n            if (i > 0) {\n                tokens.type = tokens.postDelimiter.slice(offset) + type;\n                tokens.postDelimiter = tokens.postDelimiter.slice(0, offset);\n            }\n            [tokens.postType, tokens.description] = (0, util_js_1.splitSpace)(tokens.description.slice(type.length));\n            parts.push(tokens.type);\n        }\n        parts[0] = parts[0].slice(1);\n        parts[parts.length - 1] = parts[parts.length - 1].slice(0, -1);\n        spec.type = join(parts);\n        return spec;\n    };\n}\nconst trim = (x) => x.trim();\nfunction getJoiner(spacing) {\n    if (spacing === 'compact')\n        return (t) => t.map(trim).join('');\n    else if (spacing === 'preserve')\n        return (t) => t.join('\\n');\n    else\n        return spacing;\n}\n"],"mappings":"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","ignoreList":[]}